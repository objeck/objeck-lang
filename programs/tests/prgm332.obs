class Test {
	function : Main(args : String[]) ~ Nil {
		value := 28413;
		# value := 65536;

		"value={$value}\n---"->PrintLine();
		
		bytes := EncodeInt(value, 2);
		System.IO.Console->Print("encoded: ")->Print(bytes->ToHexString())->PrintLine("\n---");
	
		value := DecodeInt(0, 2, bytes);
		"decoded={$value}\n---"->PrintLine();
	}

	function : native : EncodeInt(value : Int, num_bytes : Int) ~ Byte[] {
		bytes := Byte->New[num_bytes];

		shift := (num_bytes - 1) * 8;
		each(i : num_bytes) {
			bytes[i] := (value >> shift) and 0xff;
			shift -= 8;
		};

		return bytes;		
	}

	function : native : DecodeInt(offset : Int, num_bytes : Int, bytes : Byte[]) ~ Int {
		value := 0;
		
		shift := (num_bytes - 1) * 8;
		each(i : num_bytes) {
			value += bytes[i] and 0xff << shift;
			shift -= 8;
		};

		return value;
	}
}