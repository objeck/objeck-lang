class Test {
	function : Main(args : String[]) ~ Nil {
		value := 65535;
		# value := 65536;

		"value={$value}\n---"->PrintLine();
		
		bytes := EncodeInt(value, 2);
		System.IO.Console->Print("encoded: ")->Print(bytes->ToHexString())->PrintLine("\n---");
	
		value := DecodeInt(bytes);
		"decoded={$value}\n---"->PrintLine();
	}

	function : native : EncodeInt(value : Int, size : Int) ~ Byte[] {
		bytes := Byte->New[size];

		shift := (size - 1) * 8;
		each(i : size) {
			bytes[i] := (value >> shift) and 0xff;
			shift -= 8;
		};

		return bytes;		
	}

	function : native : DecodeInt(bytes : Byte[]) ~ Int {
		value := 0;
		
		shift := (bytes->Size() - 1) * 8;
		each(i : bytes) {
			value += bytes[i] and 0xff << shift;
			shift -= 8;
		};

		return value;
	}
}