use Collection, API.OpenAI, Game.SDL2, System.IO.Filesystem;

class Test {
	function : Main(args : String[]) ~ Nil {
		# key, message, wait_time
		if(args->Size() = 3) {
			api_token_file := args[0];
			token := FileReader->ReadFile(api_token_file);
			if(token = Nil) {
				">>> Unable to read API token file: '{$api_token_file}' <<<"->PrintLine();
				return;
			};

			response := Realtime->Respond(args[1], "gpt-4o-realtime-preview-2025-06-03", args[2]->ToInt(), token);
			if(response <> Nil & response->GetFirst() <> Nil & response->GetSecond() <> Nil) {
				response_text := response->GetFirst();
				response_text_size := response_text->Size();
	
				"text: size={$response_text_size}"->PrintLine();	
				FileWriter->WriteFile("test.txt", response_text);
				
				response_audio := response->GetSecond();
				response_audio_bytes := response_audio->Get();
				response_audio_bytes_size := response_audio_bytes->Size();
				"audio_bytes: size={$response_audio_bytes_size}"->PrintLine();
				
				file := "test.dat";
				FileWriter->WriteFile(file, response_audio_bytes);
				
				"---\nplaying audio..."->PrintLine();
				Mixer->PlayPcm(file, 22050, AudioFormat->SDL_AUDIO_S16LSB, 1);
			};
		};
	}
}