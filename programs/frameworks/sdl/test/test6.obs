use Game.SDL2;
use Game.Framework;

class Test {
	@framework : GameFramework;
	@color_white, @color_black, @color_blue, @color_red : Color;
	@half_hor_len, @vert_len : Int;
	@hor_block_lens : Int[];

	function : Main(args : String[]) ~ Nil {
		Test->New()->Run();
	}
	
	New() {
		@framework := GameFramework->New(GameConsts->SCREEN_WIDTH, GameConsts->SCREEN_HEIGHT, "War!");
		
		@color_black := Color->New(0, 0, 0);
		@framework->SetClearColor(@color_black);

		@color_white := Color->New(255,255,242);
		@color_blue := Color->New(14, 248, 248);
		@color_red := Color->New(191,0,0);

		@half_hor_len := 20;
		@vert_len := 12;

		hor := 0.0;
		@hor_block_lens := Int->New[@half_hor_len];
		each(i : @hor_block_lens) {
			hor += 0.75;
			@hor_block_lens[i] := Int->Random(hor + 1, hor + 4);
		};
	}
	
	method : Run() ~ Nil {
		if(@framework->IsOk()) {
			e := @framework->GetEvent();
			
			frame_count := 0;
			quit := false;

			while(<>quit) {
				# process input
				while(e->Poll() <> 0) {
					if(e->GetType() = EventType->SDL_QUIT) {
						quit := true;
					};
				};

				@framework->FrameStart();
				Render(frame_count);
				@framework->FrameEnd();

				frame_count += 1;
				if(frame_count >= @framework->GetFps()) {
					frame_count := 0;
				};
			};
		}
		else {
			"--- Error Initializing Environment ---"->ErrorLine();
			return;
		};

		leaving {
			@framework->Quit();
		};
	}

	method : Render(frame_count : Int) ~ Nil {
		@framework->Clear();

		block_rect := @framework->AddRectangle(20, 20);
		block_rect->SetColor(@color_blue);

		each(i : @half_hor_len) {
			vert_len := @hor_block_lens[i];
			each(j : vert_len) {
				block_rect->SetPostion(Position->New(j * 20, i * 20, 20, 20));
				block_rect->Render();
			};
		};

		@framework->GetRenderer()->LineColor(GameConsts->SCREEN_WIDTH / 2, 25, 
			GameConsts->SCREEN_WIDTH / 2, GameConsts->SCREEN_HEIGHT - 25,
			@color_red);				
		@framework->Show();
	}
}

consts GameConsts {
	SCREEN_WIDTH := 1000,
	SCREEN_HEIGHT := 400
}